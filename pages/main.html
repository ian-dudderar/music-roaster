<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <title>Rate My Music</title>
    <link href="global.css" rel="stylesheet" type="text/css" />
    <!-- <script type="text/javascript" src="https://livejs.com/live.js"></script> -->
  </head>

  <body>
    <!-- This header is my really broken way of adding padding to the top of the page-->
    <div class="header"></div>
    <div class="container">
      <div class="prompt-container">
        <p id="prompt">
          What would you like to do?
        </p>
        <a><button class="button">Roast Me</button></a>
        <a href="/playlists"><button class="button">Grade My Playlists</button></a>
      </div>
    </div>
    <!-- </main> -->
    <footer class="footer">

    </footer>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get("code");
      const state = urlParams.get("state");

    

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }


      async function textDelay(text_array) {
        let i = 1;
        let useCursor = true;
        for (let text of text_array) {
          if (i != text_array.length) {
            text = text + "..";
          } else {
            useCursor = false;
          }
          //Creates the element for the response text and passes them both to the typewriter effect
          const paragraph = document.createElement("p");
          document.querySelector(".text-container").appendChild(paragraph);

          //Creates a blinking cursor element, then deletes it before the next cycle
          let cursor = await textTypewriterEffect(paragraph, text, useCursor);
          await sleep(8000);
          if (useCursor) paragraph.removeChild(cursor);
          // paragraph.removeChild(cursor);
          i++;
        }
      }

      // Function to simulate typewriter effect
      function textTypewriterEffect(element, text, useCursor, i = 0) {
        return new Promise((resolve) => {
          element.textContent += text[i];
          element.scrollIntoView();
          if (i === text.length - 1) {
            // Create a blinking cursor element and appends it
            const cursor = document.createElement("span");
            cursor.classList.add("cursor");
            cursor.innerHTML = "|";
            if (useCursor) element.appendChild(cursor);
            // element.appendChild(cursor);
            return resolve(cursor);
          } else {
            //Slightly randomizes the speed of the typewriter
            return setTimeout(
              () =>
                resolve(textTypewriterEffect(element, text, useCursor, i + 1)),
              Math.floor(Math.random() * (30 - 0 + 1) + 0)
            );
            // return resolve(textTypewriterEffect(element, text, i + 1));
          }
        });
      }
    </script>
  </body>
</html>
