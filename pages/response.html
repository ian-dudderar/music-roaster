<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grade My Playlist</title>
    <link href="response.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="user-avatar"></div>
      </header>
      <main>
        <div class="response">
          <div id="rating-text">This is my test text</div>
          <div id="star-container">
            <svg class="star" viewBox="0 0 24 24">
              <path
                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
              />
            </svg>
            <svg class="star" viewBox="0 0 24 24">
              <path
                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
              />
            </svg>
            <svg class="star" viewBox="0 0 24 24">
              <path
                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
              />
            </svg>
            <svg class="star" viewBox="0 0 24 24">
              <path
                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
              />
            </svg>
            <svg class="star" viewBox="0 0 24 24">
              <path
                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
              />
            </svg>
          </div>
        </div>
      </main>
      <footer>
        <button id="gradeButton" disabled>Grade Another Playlist</button>
      </footer>
    </div>

    <script>
      var playlists = [];
      async function initializePage() {
        console.log("initializePage");
        const avatar = sessionStorage.getItem("avatar");
        if (avatar) {
          const avatarContainer = document.querySelector(".user-avatar");
          const avatarImg = document.createElement("img");
          avatarImg.src = avatar;
          avatarContainer.appendChild(avatarImg);
        }
        loadStars();
        const token = sessionStorage.getItem("token");
        const playlistId = new URLSearchParams(window.location.search).get(
          "playlist"
        );

        fetch(
          `/response?token=${sessionStorage.getItem(
            "token"
          )}&playlistId=${playlistId}`
        );
      }

      let selectedPlaylist = null;

      function updateGradeButton() {
        const gradeButton = document.getElementById("gradeButton");
        gradeButton.disabled = !selectedPlaylist;
      }

      function loadStars() {
        const starContainer = document.getElementById("star-container");
        const stars = document.querySelectorAll(".star");
        let visibleStars = 0;

        function fetchRandomNumber() {
          // Simulating an API call
          return new Promise((resolve) => {
            setTimeout(() => {
              resolve(Math.floor(Math.random() * 5) + 1);
            }, 1000);
          });
        }

        function positionStars(count) {
          const starWidth = 48;
          const gap = 8;
          const totalWidth = count * starWidth + (count - 1) * gap;
          const startPosition = (starContainer.offsetWidth - totalWidth) / 2;

          for (let i = 0; i < count; i++) {
            const position = startPosition + i * (starWidth + gap);
            stars[i].style.left = `${position}px`;
          }
        }

        function activateStars(count) {
          if (visibleStars < count) {
            positionStars(visibleStars + 1);
            stars[visibleStars].classList.add("active", "animate");
            visibleStars++;
            setTimeout(() => activateStars(count), 1000);
          }
        }

        fetchRandomNumber().then((count) => {
          activateStars(3);
        });
      }

      // document.addEventListener("DOMContentLoaded", loadStars);
      document.addEventListener("DOMContentLoaded", initializePage);
    </script>
  </body>
</html>
